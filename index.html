<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="JWS Abdurrahman adalah website yang menyediakan jadwal sholat harian secara akurat untuk berbagai kota di Indonesia."
    />
    <meta
      name="keywords"
      content="JWS, JWS Abdurrahman, Jadwal Sholat, Jadwal Sholat Harian, Jadwal Sholat Indonesia"
    />
    <meta name="author" content="Nama Anda" />
    <meta
      property="og:title"
      content="JWS Abdurrahman - Jadwal Sholat Harian"
    />
    <meta
      property="og:description"
      content="Dapatkan jadwal sholat harian yang akurat untuk berbagai kota di Indonesia di JWS Abdurrahman."
    />
    <meta
      property="og:image"
      content="https://link-gambar-untuk-thumbnail.jpg"
    />
    <meta property="og:url" content="https://nama-website.vercel.app/" />
    <meta name="robots" content="index, follow" />
    <title>JWS Abdurrahman</title>
    <link
      rel="shortcut icon"
      href="https://media.istockphoto.com/id/1126042167/id/vektor/tahajud-sujud-muslim-berdoa-pada-malam-hari-gaya-ikon-monoline-sederhana-untuk-perayaan.jpg?s=612x612&w=0&k=20&c=Q-gATsmIfv0zKW28Cbuk4BrgmeMss58v_p2vLjo5Myg="
      type="image/x-icon"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.cdnfonts.com/css/digital-7-mono"
      rel="stylesheet"
    />
    <style>
      @import url(http://fonts.googleapis.com/earlyaccess/droidarabickufi.css);

      #ampm {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        color: #fff;
      }
    </style>
  </head>

  <body class="bg-gray-100 text-center">
    <nav
      class="border-gray-200 bg-black/50 sticky top-0 shadow-lg backdrop-blur-sm z-[99]"
    >
      <div
        class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
      >
        <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <i class="fas fa-mosque text-indigo-600"></i>
          <span
            class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
            >JWS Abdurrahman</span
          >
        </a>
        <button
          data-collapse-toggle="navbar-solid-bg"
          type="button"
          class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
          aria-controls="navbar-solid-bg"
          aria-expanded="false"
        >
          <span class="sr-only">Open main menu</span>
          <svg
            class="w-5 h-5"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewbox="0 0 17 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M1 1h15M1 7h15M1 13h15"
            />
          </svg>
        </button>
        <div class="hidden w-full md:block md:w-auto" id="navbar-solid-bg">
          <ul
            class="flex flex-col font-medium mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"
          >
            <li>
              <a
                href="#"
                class="block py-2 px-3 md:p-0 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:dark:text-blue-500 dark:bg-blue-600 md:dark:bg-transparent"
                aria-current="page"
                >Home</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="relative w-full">
      <!-- Banner -->
      <img
        src="https://images.unsplash.com/photo-1591604129939-f1efa4d9f7fa?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8bWFzamlkJTIwbmFiYXdpfGVufDB8fDB8fHww"
        alt="banner-img"
        class="w-full h-[300px] object-cover"
      />

      <div class="absolute inset-0 bg-indigo-800 opacity-30"></div>
      <div class="absolute top-6 inset-x-0 font-bold text-white text-2xl">
        Jadwal Sholat <br />
        <span id="dateNow"></span> / <span id="dateArabic"></span> <br />
        <span class="text-slate-600">Sholat selanjutnya</span>
      </div>

      <!-- Next Azan (menindih Prayer Times) -->
      <div
        class="absolute inset-x-0 top-44 md:top-32 z-50 block md:flex items-center justify-center text-white gap-4"
      >
        <div
          id="next-azan"
          class="text-center flex font-bold bg-gradient-to-br from-indigo-500 to-indigo-700 px-12 py-6 rounded-lg mb-4 md:mb-0 mx-2 md:mx-0 shadow-2xl"
        >
          <span id="next-azan-name" class="text-3xl me-8 mt-2"></span>
          <div
            id="countdown-timer"
            class="flex justify-center items-center gap-6"
          >
            <div class="time-box flex flex-col items-center">
              <div id="hours" class="text-2xl font-medium"></div>
              <div class="text-sm text-slate-300">Jam</div>
            </div>
            <div class="time-box flex flex-col items-center">
              <div id="minutes" class="text-2xl font-medium"></div>
              <div class="text-sm text-slate-300">Menit</div>
            </div>
            <div class="time-box flex flex-col items-center">
              <div id="seconds" class="text-2xl font-medium"></div>
              <div class="text-sm text-slate-300">Detik</div>
            </div>
          </div>
        </div>

        <!-- Current Time (Hour, Min, Sec) and AM/PM Indicator in a row next to next-azan -->
        <div
          class="text-center bg-gradient-to-bl from-indigo-500 to-indigo-700 px-12 py-7 rounded-lg shadow-2xl text-4xl mb-4 md:mb-0 mx-2 md:mx-0"
          id="clock-show"
        ></div>
      </div>

      <!-- Prayer Times -->
      <div
        class="absolute inset-x-0 top-96 md:top-52 z-40 flex flex-wrap gap-8 justify-around items-center bg-white rounded-lg w-11/12 w-2/3 md:w-1/2 lg:w-2/3 xl:w-1/2 px-8 pt-12 pb-6 shadow-md justify-self-center"
      >
        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-sky-600">Imsak</div>
          <div id="imsak-time" class="text-xl text-sky-700"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-sky-600">Syuruq</div>
          <div id="sunrise-time" class="text-xl text-sky-700"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-sky-600">Dhuha</div>
          <div id="dhuha-time" class="text-xl text-sky-700"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-indigo-700">Subuh</div>
          <div id="fajr-time" class="text-xl text-indigo-800"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-indigo-700">Dzuhur</div>
          <div id="dhuhr-time" class="text-xl text-indigo-800"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-indigo-700">Ashar</div>
          <div id="asr-time" class="text-xl text-indigo-800"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-indigo-700">Maghrib</div>
          <div id="maghrib-time" class="text-xl text-indigo-800"></div>
        </div>

        <div class="flex flex-col items-center w-full sm:w-fit">
          <div class="text-2xl font-medium text-indigo-700">Isya</div>
          <div id="isha-time" class="text-xl text-indigo-800"></div>
        </div>
      </div>
    </div>

    <div class="container mx-auto mt-[920px] md:mt-12 p-8">
      <!-- Dropdown Kota -->
      <div class="mb-8">
        <label for="city" class="block text-lg font-semibold text-gray-800 mb-2"
          >Pilih Kota:</label
        >
        <select
          id="city"
          onchange="updateCity()"
          class="border p-2 mb-4 w-full"
        ></select>
      </div>

      <div
        class="bg-white bg-opacity-70 rounded-lg shadow-lg p-6 backdrop-blur-lg"
      >
        <div class="mb-4">
          <h5 class="text-lg font-semibold text-gray-800">
            Jadwal Shalat Sebulan
          </h5>
          <hr class="border-gray-300 mb-4" />
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full border border-gray-300 rounded-lg">
            <thead>
              <tr class="bg-gray-100 text-gray-700 text-sm font-medium">
                <th class="border px-4 py-2">Tanggal</th>
                <th class="border px-4 py-2">Imsak</th>
                <th class="border px-4 py-2">Subuh</th>
                <th class="border px-4 py-2">Terbit</th>
                <th class="border px-4 py-2">Dzuhur</th>
                <th class="border px-4 py-2">Ashar</th>
                <th class="border px-4 py-2">Maghrib</th>
                <th class="border px-4 py-2">Isya</th>
              </tr>
            </thead>
            <tbody id="monthly-prayer-times" class="text-gray-700 text-sm">
              <!-- Data akan dimuat di sini -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=GA_TRACKING_ID"
    ></script>
    <script>
      if ("Notification" in window && navigator.serviceWorker) {
        Notification.requestPermission().then(function (permission) {
          if (permission === "granted") {
            console.log("Notification permission granted.");
          }
        });
      }

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "GA_TRACKING_ID");

      let selectedCity = "Jakarta";
      let timerInterval;

      async function loadCities() {
        try {
          const response = await fetch("cities.json");
          const cities = await response.json();
          const citySelect = document.getElementById("city");

          cities.forEach((city) => {
            const option = document.createElement("option");
            option.value = city.name;
            option.textContent = city.name;
            citySelect.appendChild(option);
          });

          citySelect.value = selectedCity;
          await fetchPrayerTimes();
          await fetchMonthlyPrayerTimes();
        } catch (error) {
          console.error("Error loading cities:", error);
        }
      }

      async function updateCity() {
        const citySelect = document.getElementById("city");
        selectedCity = citySelect.value;
        await fetchPrayerTimes();
        await fetchMonthlyPrayerTimes();
      }

      async function fetchMonthlyPrayerTimes() {
        try {
          const response = await fetch(
            `https://api.aladhan.com/v1/calendarByCity?city=${selectedCity}&country=Indonesia&method=20`
          );
          const data = await response.json();
          const tbody = document.getElementById("monthly-prayer-times");
          tbody.innerHTML = "";

          data.data.forEach((day) => {
            const timings = day.timings;
            const row = document.createElement("tr");

            row.innerHTML = `
              <td class="border px-4 py-2 text-center">${day.date.readable}</td>
              <td class="border px-4 py-2 text-center">${timings.Imsak}</td>
              <td class="border px-4 py-2 text-center">${timings.Fajr}</td>
              <td class="border px-4 py-2 text-center">${timings.Sunrise}</td>
              <td class="border px-4 py-2 text-center">${timings.Dhuhr}</td>
              <td class="border px-4 py-2 text-center">${timings.Asr}</td>
              <td class="border px-4 py-2 text-center">${timings.Maghrib}</td>
              <td class="border px-4 py-2 text-center">${timings.Isha}</td>
            `;
            tbody.appendChild(row);
          });
        } catch (error) {
          console.error("Error fetching monthly prayer times:", error);
        }
      }

      async function fetchPrayerTimes() {
        try {
          const response = await fetch(
            `https://api.aladhan.com/v1/timingsByCity?city=${selectedCity}&country=Indonesia&method=20`
          );
          const data = await response.json();
          const timings = data.data.timings;
          const hijriDate = data.data.date.hijri;

          document.getElementById("imsak-time").innerText = timings.Imsak;
          document.getElementById("fajr-time").innerText = timings.Fajr;
          document.getElementById("dhuhr-time").innerText = timings.Dhuhr;
          document.getElementById("asr-time").innerText = timings.Asr;
          document.getElementById("maghrib-time").innerText = timings.Maghrib;
          document.getElementById("isha-time").innerText = timings.Isha;
          document.getElementById("sunrise-time").innerText = timings.Sunrise;

          document.getElementById("dateNow").innerText = new Date()
            .toLocaleDateString("id-ID", {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric",
            })
            .replace("Minggu", "Ahad");
          document.getElementById(
            "dateArabic"
          ).innerText = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year}`;

          document.getElementById("dhuha-time").innerText = calculateDhuhaTime(
            timings.Sunrise
          );
          calculateNextAzan(timings);
        } catch (error) {
          console.error("Error fetching prayer times:", error);
        }
      }

      function calculateDhuhaTime(sunriseTime) {
        const [hours, minutes] = sunriseTime.split(":").map(Number);
        const totalMinutes = hours * 60 + minutes + 20;
        const dhuhaHours = Math.floor(totalMinutes / 60) % 24;
        const dhuhaMinutes = totalMinutes % 60;

        return `${String(dhuhaHours).padStart(2, "0")}:${String(
          dhuhaMinutes
        ).padStart(2, "0")}`;
      }

      function calculateNextAzan(timings) {
        const now = new Date();
        const prayerTimes = [
          { name: "Subuh", time: timings.Fajr },
          { name: "Dzuhur", time: timings.Dhuhr },
          { name: "Ashar", time: timings.Asr },
          { name: "Maghrib", time: timings.Maghrib },
          { name: "Isya", time: timings.Isha },
        ];

        let nextAzan = null;
        let nextAzanName = null;
        let nextAzanTime = null;

        prayerTimes.forEach((prayer) => {
          const prayerDate = new Date(`${now.toDateString()} ${prayer.time}`);
          if (prayerDate > now && (!nextAzan || prayerDate < nextAzan)) {
            nextAzan = prayerDate;
            nextAzanName = prayer.name;
            nextAzanTime = prayerDate;
          }
        });

        if (!nextAzan) {
          const subuhTime = new Date(`${now.toDateString()} ${timings.Fajr}`);
          nextAzan = new Date(subuhTime.getTime() + 24 * 60 * 60 * 1000);
          nextAzanName = "Subuh";
          nextAzanTime = nextAzan;
        }

        setNotification(nextAzanTime, 10);
        setNotification(nextAzanTime, 5);

        updateCountdown(nextAzan, nextAzanName);
      }

      function setNotification(nextAzanTime, minutesBefore) {
        const notificationTime = new Date(
          nextAzanTime.getTime() - minutesBefore * 60 * 1000
        );

        const now = new Date();
        const timeUntilNotification = notificationTime - now;

        if (timeUntilNotification > 0) {
          setTimeout(() => {
            if (Notification.permission === "granted") {
              new Notification(
                `${minutesBefore} menit menuju azan ${nextAzanTime}`,
                {
                  body: `Persiapkan diri Anda untuk azan ${nextAzanTime}`,
                }
              );
            }
          }, timeUntilNotification);
        }
      }

      function updateCountdown(nextAzan, nextAzanName) {
        const azanNameElement = document.getElementById("next-azan-name");
        const hoursElement = document.getElementById("hours");
        const minutesElement = document.getElementById("minutes");
        const secondsElement = document.getElementById("seconds");

        azanNameElement.innerText = nextAzanName;

        if (timerInterval) {
          clearInterval(timerInterval);
        }

        function updateTimer() {
          const now = new Date();
          const timeDiff = nextAzan - now;

          if (timeDiff <= 0) {
            clearInterval(timerInterval);
            azanNameElement.innerText = `Waktunya ${nextAzanName}!`;
            return;
          }

          const hours = Math.floor(timeDiff / (1000 * 60 * 60));
          const minutes = Math.floor(
            (timeDiff % (1000 * 60 * 60)) / (1000 * 60)
          );
          const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

          hoursElement.innerText = hours.toString().padStart(2, "0");
          minutesElement.innerText = minutes.toString().padStart(2, "0");
          secondsElement.innerText = seconds.toString().padStart(2, "0");
        }

        updateTimer();
        timerInterval = setInterval(updateTimer, 1000);
      }

      document.addEventListener("DOMContentLoaded", () => {
        setInterval(() => {
          const now = new Date();
          const timeString = now.toLocaleTimeString("id-ID", {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
          document.getElementById("clock-show").textContent = timeString;
        }, 1000);
      });

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/service-worker.js")
          .then(function (registration) {
            console.log(
              "Service Worker registered with scope:",
              registration.scope
            );
          })
          .catch(function (error) {
            console.log("Service Worker registration failed:", error);
          });
      }

      // Event listener saat DOM selesai dimuat
      document.addEventListener("DOMContentLoaded", loadCities);
    </script>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "JWS Abdurrahman",
        "url": "https://nama-website.vercel.app/",
        "description": "JWS Abdurrahman menyediakan jadwal sholat harian secara akurat untuk berbagai kota di Indonesia.",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://nama-website.vercel.app/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        },
        "inLanguage": "id"
      }
    </script>
  </body>
</html>
